 {% extends "base_admin.html" %}
 {% block title %}
 Easy-buy | Admin
 {% endblock title %}
 {% load static %}
 {% block content %}
 <br>
 <div class="container">
 <section class="content">
 	<div class="card shadow mb-4">
 		<aside>
 			<!-- ============================ COMPONENT PROFILE  ================================= -->
 			<div class="card mb-4">
 				<div class="card-header py-3">
 					<h5 class="m-0 font-weight-bold text-primary">Registrar Subcategoría</h5>
 				</div>

 				<div class="card-body">
 					<form role="form" method="post" action="{% url 'ecommerce_app:agregar_subcategoria' %}" >

 						{% csrf_token %}
						<div class="form-row">
							<div class="col-md-4">
								<div class="col form-group">
									<label>Categoria:</label>
		                          	<select class="selectpicker form-control" data-live-search="true"style="width: 100%;" id="id_categoria" name="categoria">
		                              <option value="0">--Seleccione--</option>
                             			{% for categoria in categorias %}
	                             	 	{% ifequal categoria.pk ret_data.categoria %}
		                              	<option value='{{categoria.pk}}' selected>{{	categoria.descripcion_categoria}}</option>
		                              	{% else %}
		                              	<option value='{{categoria.pk}}'>{{categoria.descripcion_categoria}}</option>
		                              	{% endifequal %}
		                              	{% endfor %}
		                            </select>
								</div> <!-- form-group end.// -->
							</div>

							<div class="col-md-4">
								<div class="col form-group">
									<label>Subcategoría:</label>
									{% if errores.descripcion_subcategoria %}
									<div class="alert alert-danger alert-dismissible " role="alert" style="font-size: 12px">
										<strong>ERROR! </strong>{{errores.descripcion_subcategoria}}
									</div>
									{% endif %}
									<input type="text" class="form-control" id="id_descripcion_subcategoria" name="descripcion_subcategoria" placeholder="Descripción Subcategoría" value="{{ret_data.descripcion_subcategoria}}">

									
								</div> <!-- form-group end.// -->
							</div>
							{% if errores.administrador %}
							<div class="alert alert-danger alert-dismissible " role="alert">
 								<strong>ERROR! </strong>{{errores.administrador}}
 							{% endif %}
 							</div>
						</div>
						
					    <div class="col-sm-4 form-group" style="margin-left: auto; margin-right: auto;">
					        <button type="submit" class="btn btn-primary btn-block" id="guardar"> Guardar  </button>
					    </div>		
 					</form>
 				</div> <!-- card-body.// -->
 			</div> <!-- card .// -->
 			<!-- ============================ COMPONENT PROFILE END.// ================================= -->
 		</aside>
 		<!-- Tabla de registros -->
	<div class="card shadow mb-4">
		<div class="card-header py-3">
			<h5 class="m-0 font-weight-bold text-primary">Registro Subcategorías</h5>
		</div>
		<article class="card-body">
		<div class="table-responsive">
			<table  class="table table-striped table-bordered" id="tablaM"  width="100%" cellspacing="50%">
				<thead>
					<tr>
						<th>Categoría</th>
						<th>Subcategoría</th>
						<th>Detalles</th>
					</tr>
				</thead>
				<tbody>
					{% for subcategoria in subcategorias %}
						<tr>
							<td>{{subcategoria.categoria.descripcion_categoria}}</td>
							<td>{{subcategoria.descripcion_subcategoria}}</td>
							<td><button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#id_subcategoria{{subcategoria.pk}}">
			                <i class="fas fa-eye"></i>  <i class="fas fa-pencil-alt"></i>
			              	</button></td>
						</tr>
						
						<!-- Inicio Modal para editar datos-->
						<div class="modal fade" id="id_subcategoria{{subcategoria.pk}}">
						  <div class="modal-dialog">
						    <div class="modal-content">

						      <!-- Modal Header -->
						      <div class="modal-header">
						        <h4 class="modal-title">Subcategoria: {{subcategoria.descripcion_subcategoria}}</h4>
						        <button type="button" class="close" data-dismiss="modal">&times;</button>
						      </div>

						      <!-- Modal body -->
						      <div class="modal-body">
						        <form action="{% url 'ecommerce_app:modificar_subcategoria' subcategoria.pk %}" method="POST">
				        			{% csrf_token %}
					        		<div class="form-row">
										<div class="col-sm-6 form-group">
											<label>Categoría:</label>
											<select class="form-control" style="width: 100%;" id="su" name="categoria">
			                              		<option value="0" disabled selected>--Seleccione--</option>
			                              		{% for categoria in categorias %}
			                              			{% ifequal categoria.pk subcategoria.categoria.pk %} 
											  		<option value='{{categoria.pk}}' selected>{{categoria.descripcion_categoria}}</option>
												  	{% else %}
												  		<option value='{{categoria.pk}}'>{{categoria.descripcion_categoria}}</option>
												  	{% endifequal %}
			                              		{% endfor %}
		                                	</select>
										</div> <!-- form-group end.// -->
										<div class="col-sm-6 form-group">
											<label>Descripción subcategoria:</label>
										  	<input type="text" class="form-control" id="id_descripcion_subcategoria" name="descripcion_subcategoria" value="{{subcategoria.descripcion_subcategoria}}">
										</div>
									</div> <!-- form-row end.// -->
					        		 <!-- Modal footer -->
					        	    <div class="modal-footer">
							        <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
			 						<button type="submit" class="btn btn-secondary">Guardar</button>
							      </div>
						        </form>
						      </div><!-- Final Modal body -->
						    </div><!-- Final Modal content -->
						  </div><!-- Final Modal dialog -->
						</div><!-- Final Modal -->
					{% endfor %}
				</tbody>
			</table>
		</div>
		</article>
	</div>
 	</div>

 	
</section>
</div>
{% endblock content %}

{% block js %}
<script>
$(document).ready(function() {
    $('#tablaM').DataTable({
	  	language: {
            url: '{% static "json/es__es.json" %}'
        }
    });
});

    $("select#id_categoria").change(function(){
	var valor = $(this).val();
    $('.selectpicker').selectpicker('toggle');
});

   function alerta(titulo,icono){
	Swal.fire({ position: 'center', icon: icono, title: titulo, showConfirmButton: false, timer: 2100 })
	history.pushState(null,"","{% url 'ecommerce_app:agregar_marca' %}");
}

   	{% if 'ok' in request.GET %}
    	alerta('Datos guardados con éxito','success');
    {% endif %}

 	{% if 'ok1' in request.GET %}
    	alerta('Datos actualizados con éxito','success');
    {% endif %}

 	{% if 'error1' in request.GET %}
    	alerta('No se ha podido actualizar los datos','error');
    {% endif %}

	$('#guardar').click(function(e) {
	    if ($('#id_categoria').val() == 0) {
 			Swal.fire('Advertencia','Debe seleccionar la Categoría','warning')
        	return false;
	    }else if($('#id_descripcion_subcategoria').val() == ''){
	    	Swal.fire('Advertencia','Debe ingresar la descripcion de la Subcategoría','warning')
        	return false;
	    }
	});



</script>
{% endblock js %}