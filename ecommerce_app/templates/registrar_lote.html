{% extends "base_admin.html" %}
{% block title %}
Easy-buy | Registro Lote
{% endblock title %}
{% load static %}
{% block content %}
<br>
<div class="container">
    <section class="content">
        <div class="card shadow mb-4">
            <aside>
                <div class="card mb-4">
                    <div class="card-header py-3">
                        <h5 class="m-0 font-weight-bold text-primary">Registro Lote</h5>
                    </div>
                    <div class="card-body">
                        <form role="form" method="post" enctype="multipart/form-data" action="{% url 'ecommerce_app:registrar_lote' %}">
                            {% csrf_token %}
                            <div class="form-row">
                                <div class="col-md-4">
                                    <div class="col form-group">
                                        <label>Producto:</label>
                                        <select class="selectpicker form-control" data-live-search="true" style="width: 100%;" id="id_producto" name="producto">
                                            <option value="0">--Seleccione--</option>
                                            {% for pro in productos %}
                                            <option value='{{pro.pk}}'>{{pro.nombre_producto}}-{{pro.marca}}</option>
                                            {% endfor %}
                                        </select>
                                    </div> <!-- form-group end.// -->
                                </div>
                                <div class="col-md-4">
                                    <div class="col form-group">
                                        <label>Existencia:</label>
                                        <input type="text" class="form-control" id="id_existencia" name="existencia" placeholder="Existencia" value="{{ret_data.existencia}}">
                                    </div> <!-- form-group end.// -->
                                </div>
                                {% if errores.administrador %}
                                <div class="alert alert-danger alert-dismissible " role="alert">
                                <strong>ERROR! </strong>{{errores.administrador}}
                                {% endif %}
                                 {% if errores.existencia %}
                                    <div class="alert alert-danger alert-dismissible " role="alert" style="font-size: 12px">
                                        <strong>ERROR! </strong>{{errores.existencia}}
                                        </div>
                                {% endif %}
                            </div>
                            <div class="col-sm-4 form-group" style="margin-left: auto; margin-right: auto;">
                                <button type="submit" class="btn btn-primary btn-block" id="guardar"> Guardar </button>
                            </div>
                        </form>
                       </div>
                    </div> <!-- card-body.// -->
                </div>
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h5 class="m-0 font-weight-bold text-primary">Lotes detalles</h5>
                    </div>
                    <article class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered" id="tablaL" width="100%" cellspacing="50%">
                                <thead>
                                    <tr>
                                        <th>Fecha de Creción</th>
                                        <th>Porducto</th>
                                        <th>Existencia</th>
                                        <th>Modificar</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        {% for lol in lotes %}
                                        <td>{{lol.fecha_creacion}}</td>
                                        <td>{{lol.producto}}-{{lol.producto.marca}}</td>
                                        <td>{{lol.existencia}}</td>
                                        <td><button type="button" class="btn btn-outline-danger" data-toggle="modal" data-target="#lote{{lol.pk}}">
                                                Editar
                                    </tr>
                                    <!-- Inicio Modal para editar datos-->
                                    <div class="modal fade" id="lote{{lol.pk}}">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <!-- Modal Header -->
                                                <div class="modal-header">
                                                    <h4 class="modal-title">Lote de : {{lol.producto.nombre_producto}}</h4>
                                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                </div>
                                                <!-- Modal body -->
                                                <div class="modal-body">
                                                    <form action="{% url 'ecommerce_app:modificar_lote' lol.pk %}" method="POST">
                                                        {% csrf_token %}
                                                        <div class="form-row">
                                                            <div class="col-sm-12 form-group">
                                                                <label>Existencia:</label>
                                                                <input type="text" class="form-control" id="id_existencia" name="existencia" value="{{lol.existencia}}">
                                                            </div> <!-- form-group end.// -->
                                                        </div> <!-- form-row end.// -->
                                                        <!-- Modal footer -->
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-light" data-dismiss="modal">Cerrar</button>
                                                            <button type="submit" class="btn btn-primary ">Guardar</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div><!-- Final Modal content -->
                                        </div><!-- Final Modal dialog -->
                                    </div><!-- Final Modal -->
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </article>
                </div>
            </aside>
        </div>
        <!-- -->
    </section>
</div>
{% endblock content %}
{% block js %}
<script>
$(document).ready(function() {
    $('#tablaL').DataTable({
        language: {
            url: '{% static "json/es__es.json" %}'
        }
    });
}); 

    $("select#id_producto").change(function(){
        var valor = $(this).val();
        $('.selectpicker').selectpicker('toggle');
    });


    function alerta(titulo,icono){
        Swal.fire({ position: 'center', icon: icono, title: titulo, showConfirmButton: false, timer: 2100 })
        history.pushState(null,"","{% url 'ecommerce_app:registrar_lote' %}");
    }

    {% if 'ok' in request.GET %}
        alerta('Datos guardados con éxito','success');
    {% endif %}

    {% if 'ok1' in request.GET %}
        alerta('Datos actualizados con éxito','success');
    {% endif %}

    {% if 'error1' in request.GET %}
        alerta('No se pudo actualizar los datos','error');
     {% endif %}

$('#guardar').click(function(e) {
    if ($('#id_producto').val() == 0) {
    	Swal.fire({
  icon: 'warning',
  title: 'Advertencia',
  text: 'Debe seleccionar un Producto',
  
})
            return false;
        }else if($('#id_existencia').val() == ''){
        Swal.fire({
  icon: 'warning',
  title: 'Advertencia',
  text: 'Debe ingresar la cantidad en existencia',
  
})
            return false;
        }
});
</script>
{% endblock js %}