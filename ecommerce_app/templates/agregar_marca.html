 {% extends "base_admin.html" %}
 {% block title %}
 e-commerce | Admin
 {% endblock title %}
 {% load static %}
 {% block content %}
 <br>
 <div class="container">
 <section class="content">
 	<div class="card shadow mb-4">
 		<aside>
 			<!-- ============================ COMPONENT PROFILE  ================================= -->
 			<div class="card mb-4">
 				<div class="card-header py-3">
 					<h5 class="m-0 font-weight-bold text-primary">Registrar Marca</h5>
 				</div>

 				<div class="card-body">
 					<form role="form" method="post" enctype="multipart/form-data" action="{% url 'ecommerce_app:agregar_marca' %}" >

 						{% csrf_token %}
						<div class="form-row">
							<div class="col-md-4">
								<div class="col form-group">
									<label>Subcategoria:</label>
		                          	<select name="subcategoria" class="selectpicker form-control" data-live-search="true" id="id_subcategori"  >
		                              <option value="0">--Seleccione--</option>
		                             
		                             {% for subC in sub_categorias %}
		                                <option value='{{subC.pk}}'>{{subC.descripcion_subcategoria}}</option>
		                             {% endfor %}
		                            </select>
								</div> <!-- form-group end.// -->
							</div>

							<div class="col-md-4">
								<div class="col form-group">
									<label>Marca:</label>
									{% if errores.descripcion_marca %}
									<div class="alert alert-danger alert-dismissible " role="alert" style="font-size: 12px">
										<strong>ERROR! </strong>{{errores.descripcion_marca}}
									</div>
									{% endif %}
									<input type="text" class="form-control" id="id_descripcion_marca" name="descripcion_marca" placeholder="Descripción Categoría" value="{{ret_data.descripcion_marca}}">

									
								</div> <!-- form-group end.// -->
							</div>
						{% if errores.administrador %}
						<div class="alert alert-danger alert-dismissible " role="alert">
 							<strong>ERROR! </strong>{{errores.administrador}}
 							{% endif %}
 						</div>
						</div>
						
					    <div class="col-sm-4 form-group" style="margin-left: auto; margin-right: auto;">
					        <button type="submit" class="btn btn-primary btn-block" id="guardar"> Guardar  </button>
					    </div>		
 					</form>
 				</div> <!-- card-body.// -->
 			</div> <!-- card .// -->
 			<!-- ============================ COMPONENT PROFILE END.// ================================= -->
 		</aside>
 		<!-- Tabla de registros -->
	<div class="card shadow mb-4">
		<div class="card-header py-3">
			<h5 class="m-0 font-weight-bold text-primary">Registros Marca</h5>
		</div>
		<article class="card-body">
		<div class="table-responsive">
			<table  class="table table-striped table-bordered" id="tablaM"  width="100%" cellspacing="50%">
				<thead>
					<tr>
						<th>Subcategoría</th>
						<th>Marca</th>
						<th>Detalles</th>
					</tr>
				</thead>
				<tbody>
					{% for marca in marcas %}
						<tr>
							<td>{{marca.subcategoria.descripcion_subcategoria}}</td>
							<td>{{marca.descripcion_marca}}</td>
							<td><button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#id_categoria{{marca.pk}}">
			                Ver/Editar 
			              	</button></td>
						</tr>
						
						<!-- Inicio Modal para editar datos-->
						<div class="modal fade" id="id_categoria{{marca.pk}}">
						  <div class="modal-dialog">
						    <div class="modal-content">

						      <!-- Modal Header -->
						      <div class="modal-header">
						        <h4 class="modal-title">Marca: {{marca.descripcion_marca}}</h4>
						        <button type="button" class="close" data-dismiss="modal">&times;</button>
						      </div>

						      <!-- Modal body -->
						      <div class="modal-body">
						        <form action="{% url 'ecommerce_app:modificar_marca' marca.pk %}" method="POST">
				        			{% csrf_token %}
					        		<div class="form-row">
										<div class="col-sm-6 form-group">
											<label>Subcategoría:</label>
											<select class="form-control" style="width: 100%;" id="su{{marca.pk}}" name="subcategoria">
			                              		<option value="0" disabled>--Seleccione--</option>
			                              		{% for subC in sub_categorias %}
			                              			{% ifequal subC.pk marca.subcategoria.pk %} 
											  		<option value='{{subC.pk}}' selected>{{subC.descripcion_subcategoria}}</option>
												  	{% else %}
												  		<option value='{{subC.pk}}'>{{subC.descripcion_subcategoria}}</option>
												  	{% endifequal %}
			                              		{% endfor %}
		                                	</select>
										</div> <!-- form-group end.// -->
										<div class="col-sm-6 form-group">
											<label>Descripción Marca:</label>
										  	<input type="text" class="form-control" id="id_descripcion_marca{{marca.pk}}" name="descripcion_marca" value="{{marca.descripcion_marca}}">
										</div>
									</div> <!-- form-row end.// -->
					        		 <!-- Modal footer -->
					        	    <div class="modal-footer">
							        <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
			 						<button type="submit" class="btn btn-secondary">Guardar</button>
							      </div>
						        </form>
						      </div><!-- Final Modal body -->
						    </div><!-- Final Modal content -->
						  </div><!-- Final Modal dialog -->
						</div><!-- Final Modal -->
					{% endfor %}
				</tbody>
			</table>
		</div>
		</article>
	</div>
 	</div>

 	
</section>
</div>
{% endblock content %}

{% block js %}
<script>
$(document).ready(function() {
    $('#tablaM').DataTable();
});

$("select#id_subcategori").change(function(){
	var valor = $(this).val();
    $('.selectpicker').selectpicker('toggle');
});

function history_push(){
	history.pushState(null,"","{% url 'ecommerce_app:agregar_marca' %}");
}

{% if 'ok' in request.GET %}
Swal.fire({ position: 'center', icon: 'success', title: 'Datos guardados con éxito', showConfirmButton: false, timer: 2100 })
	history_push();
 {% endif %}

 {% if 'ok1' in request.GET %}
Swal.fire({ position: 'center', icon: 'success', title: 'Datos modificados con éxito', showConfirmButton: false, timer: 2100 })
 	history_push();
 {% endif %}

 {% if 'error1' in request.GET %}
Swal.fire({ position: 'center', icon: 'error', title: 'No se pudo actualizar los datos', showConfirmButton: false, timer: 2100 })
 	history_push();
 {% endif %}


$('#guardar').click(function(e) {
    if ($('#id_subcategori').val() == 0) {
    	Swal.fire({
  icon: 'error',
  title: 'Oops...',
  text: 'Debes seleccionar una ubcategoria!',
  
})
            return false;
        }
});


</script>
{% endblock js %}