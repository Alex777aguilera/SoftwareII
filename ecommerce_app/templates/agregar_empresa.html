{% extends "base_admin.html" %}  
{% block title %}
Easy-buy | Admin
{% endblock title %}
{% load static %}
{% block content %}
<!-- Hacemos referencia a a la plantilla base para la captura de los valores de una empresa -->
<br>
<div class="container">
    <section class="content">
        <div class="card shadow mb-4">
            <aside>
                <!-- ============================ COMPONENT PROFILE  ================================= -->
                <div class="row">
            <aside class="col-md-12" >
                <div class="card mb-4" style="border-radius: 10px;">
                    <!-- Aqui mostramos y capturamos los valores que se piden para el almacenamiento de la nueva empresa -->
                    <div class="card-body">
                        <h4 class="card-title mb-4">Empresa</h4>
                        <div class="form-group alert alert-info">
                            
                            <img src="{{ctx_empresa.imagen_logo.url}}" class="img-sm rounded-circle border">
                            <button type="submit" class="rounded-circle border"style="position: absolute;top: 58%; left: 12%; red"title="Ver"data-toggle="modal" data-target="#id_imagen{{ctx_empresa.pk}}"><i class="fa fa-camera "></i></button>

                        </div>
                        <hr>
                        <div class="form-row">
                            <div class="col form-group col-md-4">
                                <label><i class="icon fa fa-building"> </i> Nombre</label>
                                <div class="alert alert-info" role="alert" style="font-size: 12px">
                                    <strong>{{ctx_empresa.nombre}}</strong>
                                </div>
                            </div> <!--  -->
                             
                            <div class="form-group col-md-4">
                                <label><i class="icon fa fa-phone"> </i> # Telefono</label>
                                <div class="alert alert-info alert-dismissible " role="alert" style="font-size: 12px">
                                    <strong>{{ctx_empresa.telefono}} </strong>
                                </div>
                            </div> <!-- form-group end.// -->
                            <div class="form-group col-md-4">
                                <label><i class="icon fa fa-calendar"></i> Fecha de Registro</label>
                                <div class="alert alert-info alert-dismissible " role="alert" style="font-size: 12px">
                                    <strong>{{ctx_empresa.fecha_registro}} </strong>
                                </div>
                            </div> <!-- form-group end.// -->
                        </div> <!-- form-row.// -->

                        <div class="form-row">
                            <div class="form-group col-md-4">
                                <label><i class="icon fa fa-envelope"> </i> Correo</label>
                               <div class="alert alert-info alert-dismissible " role="alert" style="font-size: 12px">
                                    <strong>{{ctx_empresa.correo}} </strong>
                                </div>
                            </div> <!-- form-group end.// -->
                           <div class="form-group col-md-4">
                                <label><i class="icon fa fa-compass"></i> Latitud</label>
                                <div class="alert alert-info" role="alert" style="font-size: 12px">
                                    <strong>{{ctx_empresa.latitude_empresa}}</strong>
                                </div>
                            </div> <!--  -->
                            <div class="form-group col-md-4">
                                <label><i class="icon fa fa-compass"></i> Longitud</label>
                                <div class="alert alert-info" role="alert" style="font-size: 12px">
                                    <strong>{{ctx_empresa.longitude_empresa}}</strong>
                                </div>
                            </div> <!--  -->
                        </div> <!-- form-row.// -->

                        
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label><i class="icon fa fa-file-signature"></i> Descripcion</label>
                                <div class="alert alert-info" role="alert" style="font-size: 12px">
                                    <strong>{{ctx_empresa.descripcion}} </strong>
                                </div>
                            </div> <!-- form-group end.// -->
                            
                            <div class="form-group col-md-6">
                                <label><i class="icon fa fa-map-signs"> </i> Direccion</label>
                                <div class="alert alert-info alert-dismissible " role="alert" style="font-size: 12px">
                                    <strong>{{ctx_empresa.direccion}} </strong>
                                </div>
                            </div> <!-- form-group end.// -->
                        </div> <!-- form-row.// -->
                        <!-- Boton que captura el valor y lo almacena en la base de Datos correspondiente -->
                        <button class="btn btn-outline-ligh ml-2" data-toggle="modal" data-target="#datos{{ctx_empresa.pk}}">Editar</button>
                    </div>
                </div>
            </aside>
        
        
         
    </div>

    <!--  Modal para visualizar imagen de la empresa-->
                            <div class="modal fade" id="id_imagen{{ctx_empresa.pk}}">
                                <div class="modal-dialog">
                                    <div class="modal-content alert alert-info">
                                        <!-- Modal Header -->
                                        <div class="modal-header ">
                                            <h4 class="modal-title"><strong>{{ctx_empresa.nombre}}</strong></h4>
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        </div>
                                        <!-- Modal body -->
                                        <div class="modal-body">
                                            {% if ctx_empresa.imagen_logo %}
                                            <center ><img src="{{ctx_empresa.imagen_logo.url}}" width="400" height="400" style="border-radius: 5%"></center>
                                            {% else %} <br>
                                            <label for="">No se encontró imagen</label>
                                            {% endif %}
                                            <!-- Este if sirve para cargar la imagen de no encontrarla se manda un mensaje de error -->
                                        </div>
                                        <form action="{% url 'ecommerce_app:modificar_img_empresa' ctx_empresa.pk %}" method="POST" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <div class="col-sm-12 form-group">
                                            
                                            <label style="margin-left: 12.5%;"><Strong>Subir nueva Imagen</Strong></label>
                                            <center>
                                            <label for="exampleFormControlFile1">
                                            <input type="file" class="form-control-file" id="id_imagen" name="imagen" required>
                                            </label>
                                            </center>
                                        </div>
                                        <!-- Modal footer -->
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
                                            <button type="submit" class="btn btn-info">Actualizar</button>
                                            <!-- Boton para actualizar la imagen si esta fue cargada -->
                                        </div>
                                        </form>
                                    </div>
                                </div>
                            </div>


   <!--  Modal para editar informacion Empresa-->
                            <div class="modal fade" id="datos{{ctx_empresa.pk}}">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content alert alert-info">
                                        <!-- Modal Header -->
                                        <div class="modal-header">
                                            <h4 class="modal-title"><strong>Modificar datos</strong></h4>
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        </div>
                                        <!-- Modal body -->
                                        <div class="modal-body">
                                            
                                        <div class="form-group alert alert-info">
                            
                                         <img src="{{ctx_empresa.imagen_logo.url}}" class="img-sm rounded-circle border">
                                       </div>
                                        <form action="{% url 'ecommerce_app:modificar_empresa' ctx_empresa.pk %}" method="POST" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <!-- Se cargan los datos de la empresa mediante una tabla modal -->
                                    
                                            <hr>
                                            <div class="row">
                                                <div class="col-sm-4 form-group">
                                                    <label> <i class="icon fa fa-building"> </i> Nombre <i class="fas fa-asterisk" style="font-size: 0.7em; color: red;"></i></label>
                                                    <input type="text" class="form-control" placeholder="Nombre " id="id_nombre" name="nombre" value="{{ctx_empresa.nombre}}">
                                                </div> <!-- form-group end.// -->
                                                <div class="col-sm-4 form-group">
                                                    <label><i class="icon fa fa-phone"> </i> Telefono <i class="fas fa-asterisk" style="font-size: 0.7em; color: red;"></i></label>
                                                    <input type="text" class="form-control" placeholder="telefono" id="id_telefono" name="telefono" value="{{ctx_empresa.telefono}}">
                                                </div>
                                                 <div class="col-sm-4 form-group">
                                                    <label><i class="icon fa fa-calendar"></i> Fecha de registro<i class="fas fa-asterisk" style="font-size: 0.7em; color: red;"></i></label>
                                                    <input type="date" class="form-control" placeholder="fecha_registro" id="id_fecha_registro" name="fecha_registro" value="{{ctx_empresa.fecha_registro|date:'Y-m-d'}}">
                                                </div> <!-- form-group end.// -->
                                               
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-4 form-group">
                                                    <label><i class="icon fa fa-envelope"> </i> Correo <i class="fas fa-asterisk" style="font-size: 0.7em; color: red;"></i></label>
                                                    <input type="text" class="form-control" placeholder="correo" id="id_correo" name="correo" value="{{ctx_empresa.correo}}">
                                                </div> <!-- form-group end.// -->

                                                <div class="col-sm-4 form-group">
                                                    <label><i class="icon fa fa-compass"></i> Latitud <i class="fas fa-asterisk" style="font-size: 0.7em; color: red;"></i></label>
                                                    <input type="text" class="form-control" placeholder="latitude_empresa " id="id_latitude_empresa" name="latitude_empresa" value="{{ctx_empresa.latitude_empresa}}">
                                                </div> <!-- form-group end.// --> 
                                                <div class="col-sm-4 form-group">
                                                    <label><i class="icon fa fa-compass"></i> Longitud <i class="fas fa-asterisk" style="font-size: 0.7em; color: red;"></i></label>
                                                    <input type="text" class="form-control" placeholder="longitude_empresa " id="id_longitude_empresa" name="longitude_empresa" value="{{ctx_empresa.longitude_empresa}}">
                                                </div> <!-- form-group end.// -->
                                            </div> <!-- form-group end.// -->
                                                <div class="row">
                                                    <div class="col-sm-6 form-group">
                                                        <label><i class="icon fa fa-file-signature"></i> Descripción <i class="fas fa-asterisk" style="font-size: 0.7em; color: red;"></i></label>
                                                        <textarea class="form-control" placeholder="Descripción" id="id_descripcion" name="descripcion">{{ctx_empresa.descripcion}}</textarea>
                                                    </div> <!-- form-group end.// -->
                                                   <div class="col-sm-6 form-group">
                                                        <label> <i class="icon fa fa-map-signs"> </i> Dirección <i class="fas fa-asterisk" style="font-size: 0.7em; color: red;"></i></label>
                                                        <textarea class="form-control" placeholder="Dirección " id="id_direccion" name="direccion" >{{ctx_empresa.direccion}}</textarea>
                                                    </div> <!-- form-group end.// -->
                                                </div>
                                                <div class="row">
                                                 
                                                </div>
                                              
                                        </div>
                                        <!-- Modal footer -->
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
                                            <button type="submit" class="btn btn-info">Actualizar</button>
                                            <!-- Si los campos fueron corregidos mediante este boton se actualiza para que haga el cambio en la base de datos -->
                                        </div>
                                        </form>
                                        </div>
                                    </div>
                                </div>
                            </div>



                <!-- ============================ COMPONENT PROFILE END.// ================================= -->
            </aside>
            
        </div>
    </section>
</div>

{% endblock content %}
{% block js %}
<script type="text/javascript">
$(document).ready(function() {
    $('#tablaE').DataTable();
});


/*Funciones con sus respectivas validaciones */
function history_push(){
        history.pushState(null,"","{% url 'ecommerce_app:agregar_empresa' %}");
    }
function alerta(titulo,icono){
Swal.fire({ position: 'center', icon: icono, title: titulo, showConfirmButton: false, timer: 2300 })
}

// validacion para la imgaen del Empresa
    {% if 'error2' in request.GET %}

Swal.fire({ position: 'center', icon: 'error', title: 'No se pudo actualizar la imagen.', showConfirmButton: false, timer: 1500 })
      history_push();
 {% endif %}

 {% if 'ok2' in request.GET %}

Swal.fire({ position: 'center', icon: 'success', title: 'Imagen cargada con éxito.', showConfirmButton: false, timer: 1500 })
history_push(); 
 {% endif %}

 // Validacion para datos del Empresa
 {% if 'error' in request.GET %}

Swal.fire({ position: 'center', icon: 'error', title: 'No se pudo actualizar los datos.', showConfirmButton: false, timer: 1500 })
history_push();
 {% endif %}

 {% if 'ok3' in request.GET %}

Swal.fire({ position: 'center', icon: 'success', title: 'Datos modificados con éxito.', showConfirmButton: false, timer: 1500 })
history_push();
 {% endif %}

 
 {% if 'errord' in request.GET %}

Swal.fire({ position: 'center', icon: 'error', title: 'No se pudo actualizar los datos.', showConfirmButton: false, timer: 1500 })
history_push();
 {% endif %}

 {% if 'okd' in request.GET %}

Swal.fire({ position: 'center', icon: 'success', title: 'Datos modificados con éxito.', showConfirmButton: false, timer: 1500 })
history_push();
 {% endif %}
</script>
{% endblock js %}